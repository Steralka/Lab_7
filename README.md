# Лабораторная работа #7 - Многопользовательский клиент-сервер с БД PostgreSQL

Вариант: 49044

## Усовершенствования к предыдущей версии

### Основные изменения:
1. **Хранение данных в PostgreSQL** вместо файлов
2. **Система аутентификации** пользователей
3. **Многопоточная обработка** запросов
4. **Разграничение прав** доступа к объектам коллекции

## Технические требования

### 1. Работа с базой данных:
- Использование **PostgreSQL** (хост: `pg`, БД: `studs`)
- Генерация ID через sequence
- Хранение хешей паролей (SHA-256)
- Привязка объектов к пользователям

### 2. Многопоточность:
- **Cached thread pool** для чтения запросов
- **Отдельные потоки** (Thread) для обработки
- **Fixed thread pool** для отправки ответов
- Синхронизация через **ReadWriteLock**

### 3. Безопасность:
- Обязательная авторизация для команд
- Проверка прав на модификацию объектов
- Передача учетных данных с каждым запросом

## Архитектура системы

### Серверные модули:
1. **Модуль подключения к БД** (JDBC)
2. **Модуль аутентификации**
3. **Модуль управления потоками**
4. **Модуль обработки команд**
5. **Модуль синхронизации доступа**

### Клиентские изменения:
- Добавлена **система логина/пароля**
- Модифицированный **формат запросов** (с учетными данными)
- Обработка **ошибок доступа**

## Реализация БД

### Основные таблицы:
```sql
CREATE TABLE users (
    login VARCHAR(50) PRIMARY KEY,
    password_hash VARCHAR(64) NOT NULL  -- SHA-256
);

CREATE TABLE labworks (
    id BIGINT PRIMARY KEY DEFAULT nextval('labwork_id_seq'),
    owner_login VARCHAR(50) REFERENCES users(login),
    name VARCHAR(100) NOT NULL,
    -- остальные поля объекта
    creation_date TIMESTAMP WITH TIME ZONE NOT NULL
);
```

## Запуск системы

### Сервер:
```bash
java -jar server.jar [port] [db_url] [db_user] [db_password]
```

### Клиент:
```bash
java -jar client.jar [host] [port] [login] [password]
```

## Отчетные материалы

1. **Диаграмма классов** (обновленная версия)
2. **Исходный код** с комментариями
3. **Примеры SQL-запросов**
4. **Тестовые сценарии**:
   - Регистрация/авторизация
   - Проверка прав доступа
   - Многопоточная работа
5. **Выводы** по работе

## Вопросы к защите

1. **Многопоточность** в Java
2. **Синхронизация** и блокировки
3. **Работа с БД** через JDBC
4. **Пул потоков** и ExecutorService
5. **Шаблоны проектирования**, примененные в работе

## Особенности реализации

1. **Безопасность**:
   - Все пароли хранятся как SHA-256 хеши
   - Проверка прав при каждой операции модификации

2. **Производительность**:
   - Оптимальное использование пулов потоков
   - Минимизация блокировок через ReadWriteLock

3. **Надежность**:
   - Автоматическое восстановление соединения с БД
   - Обработка временной недоступности сервера
